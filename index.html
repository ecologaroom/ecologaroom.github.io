<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Página Inicial</title>
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/inicio.css">
    <!--  Carga el núcleo de Firebase JS SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
     Agrega el manejo de autenticación. 
    <!--  Agrega el manejo de autenticación. -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js">
    </script>
     Agrega el manejo de cloud firestore. 
    <!--  Agrega el manejo de cloud firestore. -->
    <script
    src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js">
    </script>-->
    <script src="js/navegacion.js"></script>
    <script src="js/autenticacion.js"></script>
    <!-- <script src="js/login.js"></script>-->
  </head>
  <body>
    <form class="Inicio">
      <!-- Barra de navegación -->
      <nav class="navbar">
        <!-- Logo a la izquierda-->
        <div class="logo"><img class="imagen_logo" src="img/Logo.png" loading="lazy"/></div>
        <!-- Logo a la izquierda-->
        <!-- Reservación inmediata a la derecha -->
        <div class="reservacion">
          <!-- Fecha de entrada -->
          <label for="Fecha">Fecha de entrada:</label>
          <input type="date" id="Fecha_llegada" name="Fecha_llegada" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}">
          <!-- Fecha de salida -->
          <label for="Fecha">Fecha de salida:</label>
          <input type="date" id="Fecha_salida" name="Fecha_salida" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}">
          <!-- Número de huéspedes -->
          <label for="Fecha"># huéspedes:</label>
          <input type="number" id="Num_huesped" name="Num_huesped">
          <!-- Botón de la reservación -->
          <button type="button" id="btnReservar"  onClick="formLogin();">Reservar</button>
        </div>
        <!-- Reservación inmediata a la derecha -->
      </nav>
      <!-- Barra de navegación -->
      <!-- Menú -->
      <section class="menu" role="group">
        <!-- Botón de Inicio -->
        <button type="button" class="menuNBtn" style="font-size:34px;">INICIO</button>
        <!-- Botón de Habitaciones -->
        <button type="button" onClick="formHabitaciones();" class="menuBtn" style="font-size:16px;">HABITACIONES</button>
        <!-- Botón de Intalaciones -->
        <button type="button" onClick="formInstalaciones();" class="menuBtn" style="font-size:15px;">INSTALACIONES</button>
        <!-- Botón de Turismo -->
        <button type="button" onClick="formTurismo();" class="menuBtn" style="font-size:26px;">TURISMO</button>
        <!-- Botón de Restaurantes -->
        <button type="button" onClick="formRestaurantes();" class="menuBtn" style="font-size:15px;">RESTAURANTES</button>
        <!-- Botón de FAQ -->
        <button type="button" onClick="formFAQ();" class="menuBtn" style="font-size:46px;">FAQ</button>
      </section>
      <!-- Menú -->
      <!-- Contenido -->
      <section class="contenido">
        <!-- Portada -->
        <div class="portada">
          <img class="fondo" src="img/Portada.gif"/>
          <h1 class="bienvenido">¡BIENVENID@ A ECOLOGAROOM!</h1>
        </div>
        <!-- Portada -->
        <!-- Descripcióm -->
        <div class="descripcion">
          <h2>Descripción</h2>
          En Hotel Ecologaroom, tendrás a tu alcance una magnífica oferta que combina inteligentemente lujo, confort y practicidad, brindándote como resultado la mejor experiencia de hospedaje en La Paz, B.C.S.
        </div>
        <!-- Descripción -->
        <!-- Descripcióm -->
        <div class="nosotros">
          <h2>Acerca nostros</h2>
          Localizado en el centro del puerto de ilusión, la ciudad de los 365 atardeceres, en Ecologaroom, hotel de 4 estrellas, tendrás a tu alcance una fantástica oferta que combina inteligentemente lujo, confort y practicidad, dando como resultado la mejor y más nueva experiencia de hospedaje en La Paz, B.C.S.
          A su disposición está el uso de computadoras con acceso a internet, así como servicio de impresión y copias. Además, contamos con piscina, máquina de refrigerios, estacionamiento y servicio de coffee break por solicitar.
        </div>

        <!-- Descripción -->
        <button type="button" onClick="terminaSesion();">Cerrar sesión</button>
        <output id="nombre"></output>

        <!-- Pie de página -->
        <footer>
          <!-- Contenedor de la retícula -->
          <div class="retícula">
            <!-- Sección: Contacto -->
            <section class="contacto">
              <h3>CONTACTO</h3>
              <!-- Número -->
              <a class="icon" title="Llámanos" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/llamada-telefonica.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>  
              <!-- Email -->
              <a class="icon" title="Mandanos un correo" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/email.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>
              <!-- Ubicación -->
              <a class="icon" title="Buscanos en Google Maps" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/placeholder.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>
            </section>
            <!-- Sección: Contacto -->
          </div>
          <!-- Contenedor de la retícula -->
      
          <!-- Copyright -->
          <div class="copyright" style="background-color: rgba(0, 0, 0, 0.2);">
            Copyright &copy; 2021
          </div>
          <!-- Copyright -->
        </footer>
        <!-- Pie de página -->
      </section>
      <!-- Contenido -->
<script> 
btnReservar.addEventListener("click", e =>{
          /** Conexión al sistema de autenticación de Firebase. */
          // @ts-ignore
          const auth = firebase.auth();
          /** Tipo de autenticación de usuarios. En este caso es con Google. */
          // @ts-ignore
          const provider = new firebase.auth.GoogleAuthProvider();
          /* Configura el proveedor de Google para que permita seleccionar de una lista. */
          provider.setCustomParameters({ prompt: "select_account" });
          /* Recibe una función que se invoca cada que hay un cambio en la autenticación y recibe el modelo con las características del usuario.*/
          auth.onAuthStateChanged(
            /** Recibe las características del usuario o null si no ha iniciado
             * sesión. */
            async usuarioAuth => {
              if (usuarioAuth && usuarioAuth.email) {
                // Usuario aceptado.
                /* Muestra los mensajes del chat.
                muestraMensajes();*/
              } else {
                // No ha iniciado sesión. Pide datos para iniciar sesión.
                await auth.signInWithRedirect(provider)
                      .then(() => {
                        location.href = 'FAQ.html';
                // Sign-out successful.
                }).catch((error) => {
  // An error happened.
                          });
              }
            },
            // Función que se invoca si hay un error al verificar el usuario.
            procesaError
          );
        })
  
  
  /* Terminar la sesión. */
  async function terminaSesion() {
    try {
        await auth.singOut();
    } catch (e) {
        procesaError(e);
    }
  }
  
  /* Procesa un error. Muestra el objeto en la consola y un cuadro de alerta con el mensaje. @param {Error} e descripción del error. */
  function procesaError(e) {
  console.log(e);
  alert(e.message);
  }
  </script>

 <!-- 
// Login con Google
function formLogin(){
    /* Configura el proveedor de Google para que permita seleccionar de una lista. */
    provider.setCustomParameters({ prompt: "select_account" });
    /* Recibe una función que se invoca cada que hay un cambio en la autenticación y recibe el modelo con las características del usuario. */
    auth.onAuthStateChanged(
        /* Recibe las características del usuario o null si no ha iniciado sesión. */
        usuarioAuth => {
            if (usuarioAuth && usuarioAuth.email) {
                /* Nombre de usuario atenticado por Firebase y aceptado. */
                nombre.value = usuarioAuth.email; 
            } else {
                /* No ha iniciado sesión. Pide datos para iniciar sesión. */
                auth.signInWithRedirect(provider);
            }
        },
        /* Función que se invoca si hay un error al verificar el usuario. */
        procesaError
    );
};

/* Terminar la sesión. */
async function terminaSesion() {
    try {
        await auth.singOut();
    } catch (e) {
        procesaError(e);
    }
}

/* Procesa un error. Muestra el objeto en la consola y un cuadro de alerta con el mensaje. @param {Error} e descripción del error. */
function procesaError(e) {
  console.log(e);
  alert(e.message);
}
      </script>

-->  

    <!-- 
    <script>
    
      /** Conexión a la base de datos. */
      // @ts-ignore
      const firestore = firebase.firestore();
      /** Agrega un usuario a la base de datos. */
      function agrega() {
        /* "MENSAJE" es el nombre de la colección a la que se agregan los datos.
         * "USUARIO", "TEXTO" y "TIMESTAMP" son los nombres de los campos en el
         * documento.
         * El timestamp contiene la fecha y hora en que se agrega el registro.*/
        firestore.collection("MENSAJE").add({
          USUARIO: usuario,
          // @ts-ignore
          TEXTO: texto.value.trim(),
          // @ts-ignore
          TIMESTAMP: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
      /** Muestra los mensaje almacenados en la collection "MENSAJE". Se
       * actualiza automáticamente. */
      function muestraMensajes() {
        /* Consulta que se actualiza automáticamente. Pide todos los registros
         * de la colección "MENSAJE" ordenador por el campo "TIMESTAMP" de forma
         * descendiente. */
        firestore.collection("MENSAJE").orderBy("TIMESTAMP", "desc")
          .onSnapshot(
            /** Función que muestra los datos enviados por el servidor. Si los
             * datos cambian en el servidor, se vuelve a invocar esta función y
             * recibe los datos actualizados.
             * @param {Array} querySnapshot estructura parecida a un Array, que
             * contiene una copia de los datos en el servidor. */
            querySnapshot => {
              // Vacía la lista con los mensajes.
              // @ts-ignore
              mensajes.innerHTML = "";
              /* Revisa un por uno los registros de la consulta y los muestra.
               * El iterador "doc" es un registro de la base de datos. */
              querySnapshot.forEach(doc => {
                // recupera los datos almacenados en el registro.
                const data = doc.data();
                
                var d = data.TIMESTAMP.toDate(),
                dformat = [d.getDate(), d.getMonth()+1, d.getFullYear()].join('/')+' '+
                          [d.getHours(),d.getMinutes(),d.getSeconds()].join(':');
                /* Agrega un li con los datos del registro, que se codifican
                 * para evitar inyección de código. */
                // @ts-ignore
                mensajes.innerHTML += /* html */
                  `<li><u>${cod(data.USUARIO)}</u> ${dformat}<br>${cod(data.TEXTO)}</li>`;
              })
            },
            /* Función que se invoca cuando hay un error. Muestra el error. Al
             * invocar esta función la conexión se cancela. Por lo mismo, se
             * vuelve a conectar. */
            e => {
              procesaError(e);
              // Intenta conectarse otra vez.
              muestraMensajes();
            }
          )
      }



      /** Map que contiene el texto de escape de los caracteres especiales de
       * HTML.
       * @type {Readonly<Map<string, string>> } */
      const codMap = Object.freeze(new Map([['&', '&amp;'], ['<', '&lt;'],
      ['>', '&gt;'], ['"', '&quot;'], ["'", '&#039;']]));

      /** Codifica un texto para que escape los caracteres especiales y no se
       * pueda interpretar como HTML. Esta técnica evita la inyección de código.
       * @param {string} texto
       * @returns {string} un texto que no puede interpretarse como HTML. */
      function cod(texto) {
        return (texto || "").replace(/[&<>"']/g, letra => codMap.get(letra));
      }
    </script>
  -->
    </form>
  </body>
</html>
