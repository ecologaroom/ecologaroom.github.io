<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- Adaptación de pantalla a distintos dispositivos -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Título en pestaña de navegación -->
    <title>Tabla de reservaciones</title>
    <!-- Hojas de estilos -->
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/reservacion_recepcion.css">
    <!-- Carga el núcleo de Firebase JS SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <!-- Agrega el manejo de autenticación. -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <!-- Agrega el manejo a Cloud Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- Conexión a firebase -->
    <script src="js/autenticacion.js"></script>
    <!-- Navegación interna de la página -->
    <script src="js/navegacion.js"></script>
  </head>
  <body>
    <!-- Página -->
    <div class="pagina">

      <!-- Barra de navegación -->
      <nav class="navbar">
        <!-- Logo a la izquierda-->
        <div class="logo"><img class="imagen_logo" src="img/Logo.png" loading="lazy"/></div>
        <!-- Logo a la izquierda-->

        <!-- Reservación inmediata a la derecha -->
        <div class="reservacion">
          <!-- Fila responsiva -->
          <div class="fila">
            <!-- Fecha de entrada -->
            <div class="colum">
              <div class="inputFlotante">
                <label for="Fecha">Fecha de entrada:</label>
                <input type="date" id="Fecha_llegada" name="Fecha_llegada" maxlength="10" required pattern="^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d$" required>
              </div>
            </div>
            <!-- Fecha de entrada -->

            <!-- Fecha de salida -->
            <div class="colum">
              <div class="inputFlotante">
                <label for="Fecha">Fecha de salida:</label>
                <input type="date" id="Fecha_salida" name="Fecha_salida" maxlength="10" required pattern="^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d$" required>
              </div>
            </div>
            <!-- Fecha de salida -->

            <!-- Número de huéspedes -->
            <div class="colum">
              <div class="inputFlotante">
                <label for="Fecha"># huéspedes:</label>
                <input type="number" id="Num_huesped" name="Num_huesped" maxlength="3" min="1" max="100" required>
              </div>
            </div>
            <!-- Número de huéspedes -->

            <!-- Botón de reservar -->
            <div class="colum">
              <div class="inputFlotante">
                <button type="button" class="btn" onclick="formLogin();">Reservar</button>
              </div>
            </div>
            <!-- Botón de la reservar -->
          </div>
          <!-- Fila responsiva -->
        </div>
        <!-- Reservación inmediata a la derecha -->
      </nav>
      <!-- Barra de navegación -->

     
      
      <!-- Contenido -->
      <section class="contenedor">
        <!-- Título -->
        <h1>RESERVACIONES</h1>
        <!-- Título -->

        <!-- División -->
        <div class="division"></div>
        <!-- División -->

        <!-- Envoltura -->
        <div class="card">
          <div class="cabeza">

            <div class="busqueda">
              <div class="inputFlotante">
                <input class="floating__input" name="Calendario" type="date" placeholder="Calendario" maxlength="10" required pattern="^(?:(?:31(/|-|.)(?:0?[13578]|1[02]))1|(?:(?:29|30)(/|-|.)(?:0?[1,3-9]|1[0-2])2))(?:(?:1[6-9]|[2-9]d)?d{2})$|^(?:29(/|-|.)0?23(?:(?:(?:1[6-9]|[2-9]d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1d|2[0-8])(/|-|.)(?:(?:0?[1-9])|(?:1[0-2]))4(?:(?:1[6-9]|[2-9]d)?d{2})$" required/>
                <label class="floating__label" data-content="Calendario"></label>
              </div>
            </div>

            <div class="busqueda">
              <div class="inputFlotante">
                <input class="floating__input" name="buscar" type="search" placeholder="Buscar" maxlength="40" size="30" required pattern="([a-zA-Z ñáéíóú]{3,40}\s*)+" required/>
                <label class="floating__label" data-content="Buscar"></label>
              </div>
            </div>
          </div>

          <!-- Tabla de reservaciones en tiempo real -->
          <table>
            <tr>
              <th>#Habitación</th>
              <th>Reservación</th>
              <th>Estatus</th>
              <th>Huésped</th>
              <th>Fecha de reservación</th>
              <th>Hora de entrada</th>
              <th>Fecha y hora de salida</th>
              <th>#Huéspedes</th>
            </tr>
            <tr>
              <td><output id="num_hab">111</output></td>
              <td><output id="clv_res">1VHCA1180222</output></td>
              <td><output id="estatus">A</output></td>
              <td><output id="nom">Claudia Ixchel Valadez Hernandez</output></td>
              <td><output id="fecha_res">14/03/2022</output></td>
              <td><output id="hora_ent">20:00</output></td>
              <td><output id="sal">18/03/2022 12:00</output></td>
              <td><output id="num_hues">4</output></td>
            </tr>
            <tr>
              <td><output id="num_hab">999</output></td>
              <td><output id="clv_res">1VHCA1180222</output></td>
              <td><output id="estatus">I</output></td>
              <td><output id="nom"></output></td>
              <td><output id="fecha_res"></output></td>
              <td><output id="hora_ent"></output></td>
              <td><output id="sal"></output></td>
              <td><output id="num_hues"></output></td>
            </tr>
          </table>
          <!-- Tabla de reservaciones en tiempo real -->
        </div>
        <!-- Envoltura -->

        

        <!-- Pie de página -->
        <footer>
          <!-- Contenedor de la retícula -->
          <div class="retícula">
            <!-- Sección: Contacto -->
            <section class="contacto">
              <h3>CONTACTO</h3>
              <!-- Número -->
              <a class="icon" title="Llámanos" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/llamada-telefonica.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>  
              <!-- Email -->
              <a class="icon" title="Mandanos un correo" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/email.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>
              <!-- Ubicación -->
              <a class="icon" title="Buscanos en Google Maps" href="https://goo.gl/maps/DMi8wx4pS4wtUn2z5"><img src="img/placeholder.png" height="30" width="30" style="background-color: rgba(251, 251, 251, 0.6)"/></a>
            </section>
            <!-- Sección: Contacto -->
          </div>
          <!-- Contenedor de la retícula -->
      
          <!-- Copyright -->
          <div class="copyright" style="background-color: rgba(0, 0, 0, 0.2);">Copyright &copy; 2021</div>
          <!-- Copyright -->
        </footer>
        <!-- Pie de página -->
      </section>
      <!-- Contenido -->
    </div>
    <!-- Página -->

    <script>
      /* Actualización automáticamente de los datos de reservación en la tabla de reservaciones */
function actualizaReservacion(){
  /* Se pide a Firebase todos los registros de la colección RESERVACION ordenados por el campo del NUM_HABITACION de forma ascendente */
  firestore.collection("RESERVACION").orderBy("NUM_HABITACION", "desc")
    .onSnapshot(
      /* Función con copia de datos en servidor, para la actualización cada que se modifica el servidor */
      querySnapshot => {
        /* Se vacia lista con los números de habitación */
        num_hab.innerHTML = "";
        /* Revisa y muestra cada registro de la muestra */
        querySnapshot.forEach(doc => {
          /* Recupera datos almacenados en el registro */
          const data = doc.data();

          num_hab.innerHTML +=
            '<li><u>${cod(data.NUM_HABITACION)}</u></li>';
        })
      },
      e => {
        procesaError(e);
        /* Intenta conectarse nuevamente */
        actualizaReservacion();
      }
    )
}

/* Procesa un error. Muestra el objeto en la consola y un cuadro de alerta con el mensaje. @param {Error} e descripción del error. */
function procesaError(e) {
  console.log(e);
  alert(e.message);
}

/* Map que contiene el texto de escape de caracteres especiales */
const codMap = Objec.freeze(new Map([['&', '&amp;'],['<','&lt;'],['>','&gt;'],['"','&quot;'],["'",'&#039;']]));

/* Codifica texto para que escape los caracteres especiales y no se interprete como HTML */
function cod(texto){
  return (texto||"").replace(/[&<>"']/g, letra => codMap.get(letra));
}

    </script>
  </body>
</html>